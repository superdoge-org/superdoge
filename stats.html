<script>
  const formatter = n => Number(n).toLocaleString(undefined, { maximumFractionDigits: 6 });

  async function loadStats() {
    try {
      const [totalData, tokenData, bnbData, liquidity, allData] = await Promise.all([
        fetch("/stats/total-supply.json").then(r => r.json()),
        fetch("/stats/token-price.json").then(r => r.json()),
        fetch("/stats/bnb-price.json").then(r => r.json()),
        fetch("/stats/liquidity.json").then(r => r.json()),
        fetch("/stats/all-data.json").then(r => r.json())
      ]);

      const totalSupply = Number(totalData.totalSupply);
      const totalBurned = 1_000_000_000 - totalSupply;
      document.getElementById("totalSupply").textContent = formatter(totalSupply) + " SUPDOG";
      document.getElementById("totalBurned").textContent = formatter(totalBurned) + " SUPDOG";
      document.getElementById("tokenPrice").textContent = "$" + formatter(tokenData.price);
      document.getElementById("marketCap").textContent = "$" + formatter(totalSupply * tokenData.price);
      document.getElementById("bnbPrice").textContent = "$" + formatter(bnbData.price);
      document.getElementById("liquidityUSD").textContent = "$" + formatter(liquidity.totalUSD);
      document.getElementById("liquidityBNB").textContent = formatter(liquidity.totalBNB) + " BNB";

      const table = document.getElementById("dailyTable");
      table.innerHTML = "";

      let volume30d = 0;
      let burnedSinceJul4 = 0;
      const now = new Date();

      for (const entry of allData) {
        const logDate = new Date(entry.date);
        const daysAgo = (now - logDate) / (1000 * 60 * 60 * 24);

        if (daysAgo <= 30) volume30d += entry.volume;
        if (logDate >= new Date("2025-07-04")) burnedSinceJul4 += entry.burned;

        const row = `
          <tr>
            <td>${entry.date}</td>
            <td>${formatter(entry.totalSupply)}</td>
            <td>${formatter(entry.burned)}</td>
            <td>${formatter(entry.volume)}</td>
            <td>$${formatter(entry.price || 0)}</td>
            <td>$${formatter(entry.liquidityUSD || 0)}</td>
          </tr>`;
        table.innerHTML += row;
      }

      document.getElementById("volume30d").textContent = formatter(volume30d) + " SUPDOG";
      document.getElementById("burnSinceJul4").textContent = formatter(burnedSinceJul4) + " SUPDOG";

    } catch (err) {
      console.error("‚ùå Error loading stats data:", err);
      document.getElementById("dailyTable").innerHTML = `<tr><td colspan="6">Error loading data.</td></tr>`;
    }
  }

  loadStats();
</script>
