<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SUPDOG Value Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 800px;
      margin: 2rem auto;
      padding: 1rem;
      background: #f9f9f9;
      color: #333;
    }
    input, select {
      padding: 0.5rem;
      margin: 0.5rem 0;
      width: 100%;
      font-size: 1rem;
    }
    .result {
      background: #fff;
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }
    h2 { margin-top: 2rem; }
  </style>
</head>
<body>
  <h1>SUPDOG Value Calculator</h1>
  <p>Estimate value from <strong>buying</strong> or <strong>selling</strong> SUPDOG, based on live liquidity data.</p>

  <label for="mode">Calculation Mode:</label>
  <select id="mode">
    <option value="sell">Sell (realize value from SUPDOG)</option>
    <option value="buy">Buy (acquire SUPDOG with BNB)</option>
  </select>

  <input type="number" id="holdings" placeholder="Enter amount of SUPDOG (or BNB to buy)" />

  <div class="result" id="output">
    <p>Loading data...</p>
  </div>

  <script>
    const fetchData = async () => {
      const [supply, price, bnbPrice, liquidity] = await Promise.all([
        fetch('/stats/total-supply.json').then(r => r.json()),
        fetch('/stats/token-price.json').then(r => r.json()),
        fetch('/stats/bnb-price.json').then(r => r.json()),
        fetch('/stats/liquidity.json').then(r => r.json())
      ]);

      return {
        totalSupply: supply.totalSupply,
        tokenPrice: price.price,
        bnbPrice: bnbPrice.price,
        totalBNB: liquidity.totalBNB,
        totalUSD: liquidity.totalUSD
      };
    };

    const format = x => Number(x).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 6 });
    const formatInt = x => Number(x).toLocaleString();

    const calculate = async () => {
      const data = await fetchData();
      const input = document.getElementById('holdings');
      const mode = document.getElementById('mode').value;
      const out = document.getElementById('output');

      const raw = parseFloat(input.value);
      if (!raw || raw <= 0) {
        out.innerHTML = '<p>Please enter a valid amount.</p>';
        return;
      }

      const { totalSupply, tokenPrice, totalBNB, totalUSD, bnbPrice } = data;

      if (mode === 'sell') {
        const holdings = raw;
        const percentSupply = holdings / totalSupply;
        const valueUSD = holdings * tokenPrice;
        const valueMarketCapShare = percentSupply * (totalSupply * tokenPrice);
        const valueLiquidityBNB = percentSupply * totalBNB;
        const valueLiquidityUSD = percentSupply * totalUSD;

        const afterTaxBNB = valueLiquidityBNB * 0.94; // 6% tax
        const estimatedRealizedBNB = afterTaxBNB * 0.85; // 15% slippage

        out.innerHTML = `
          <h2>üìä Sell Estimate</h2>
          <p><strong>Current Token Price:</strong> $${format(tokenPrice)}</p>
          <p><strong>Your SUPDOG Holdings:</strong> ${formatInt(holdings)} tokens</p>
          <p><strong>Your Share of Total Supply:</strong> ${(percentSupply * 100).toFixed(4)}%</p>

          <h3>üíµ Spot Value</h3>
          <p>‚âà <strong>$${format(valueUSD)}</strong> (before tax/slippage)</p>

          <h3>üíß Proportional Liquidity</h3>
          <p>‚âà <strong>${format(valueLiquidityBNB)} BNB</strong> / $${format(valueLiquidityUSD)}</p>

          <h3>‚ö†Ô∏è After Tax & Slippage</h3>
          <p>‚âà <strong>${format(estimatedRealizedBNB)} BNB</strong> (6% tax + 15% slippage)</p>

          <p style="font-size: 0.9rem; color: #666;">
            6% transaction tax applied: 2% burn, 2% redistribution, 2% foundation.
            Estimated slippage assumes token is sold into liquidity pool.
          </p>
        `;
      } else {
        const bnbInput = raw;
        const netBNB = bnbInput * 0.94; // buying also taxed 6%
        const supdogReceived = (netBNB / bnbPrice) / (1 / tokenPrice);

        out.innerHTML = `
          <h2>üõí Buy Estimate</h2>
          <p><strong>BNB Input:</strong> ${bnbInput} BNB</p>
          <p><strong>Net BNB after 6% tax:</strong> ${format(netBNB)} BNB</p>
          <p><strong>SUPDOG Received:</strong> ‚âà <strong>${formatInt(supdogReceived)}</strong> tokens</p>

          <p style="font-size: 0.9rem; color: #666;">
            SUPDOG is taxed on purchase: 2% burn, 2% redistribution, 2% foundation.
            Value assumes price and liquidity remain constant.
          </p>
        `;
      }
    };

    document.getElementById('holdings').addEventListener('input', calculate);
    document.getElementById('mode').addEventListener('change', calculate);
    calculate(); // initial run
  </script>
</body>
</html>
